### Implementation process on slack_bot

#### 휴가 / 연차 시스템 초기 설정 구축

- 명령어 입력을 받기 위한 리스트를 먼저 구성
- 명령어 입력을 하고 특정 토큰 부분을 확인해서 리스트에 있는지 확인
- 리스트의 가장 첫번째 저장된 문자열을 반환
- 해당 문자열에 맞게 상태 변경
- 상태를 확인하고 그에 맞는 함수 호출

#### 문서 4종 생성 관련

- 문서 생성시 기업명 정보를 google spreadsheet로부터 load 해야 함
  - 이와 관련된 발생 가능한 예외 처리 진행
  - 예외 발생시 에러 메세지 출력하고 즉시 종료 (user_states[] 해당 정보 del 하는 방향으로 구현)

#### 휴가 / 연차 시스템 프로세스 - 신청 시스템 

- [x] 휴가 / 연차 신청(추가) 함수 구현 완료
- [x] user_vacation_info, user_vacation_status로 user_id의 인덱싱을 활용해 정보 및 상태 관리
  - [x] slack bot 개발의 경우 이벤트 함수 콜이 독립적으로 진행되기 때문에, 해당 함수를 계속 call 해줘야 순차적인 데이터 입력이 가능 (다른 input을 연속으로 기다릴 수 없음)
  - [x] 따라서 status를 활용해서 각 상태 별 진행되는 행위(입력을 받거나 혹은 검증을 진행하거나)에 맞는 함수를 call 해야 한다
  - [x] 각각 입력한 정보가 검증이 된 이후에는 user_vacation_info에 value로 append 된다
    - [x] 처음에는 빈 리스트로 구성하고 이후에 .append()로 정보를 담는다
    - [x] 초기화하는 경우, 대표적인 상황으로 '종료'를 누르게 되면 해당 정보를 user_states, user_vacation_info, user_vacation_status에서 관련된 모든 것들을 삭제
- [x] 예외 처리 완료(ex.날짜 형식 미준수, 날짜 선후 미준수, 숫자 형식 미준수... 등등 처리 완료)

- [x] : 남은 휴가 일수와 비교했을 때 신청 가능 여부 살펴보기 in vacation_request
  - [x] : 남은 휴가 일수를 조회하는 함수 구현을 진행해야 한다
    - [x] : 3번째 시트 연결 - 첫번째 이름 비교 - 같은 이름의 해당 데이터의 [연차 휴가 잔여일수 , 안식 휴가 잔여일수] 반환하는 형태로 구성하기
    - **유의** 종료를 입력할 일이 없는 일회성 기능, 따라서 종료를 입력한 경우를 고려하지 않음. 기능 실행 이후 바로 종료
  - [x] : 개인 휴가인 경우와 안식 휴가인 경우를 각각 구분해야 한다
    - [x] : get_remained_vacation_by_userId(spreadsheet_id, user_id) - [개인 휴가 잔여, 안식 휴가 잔여] 반환
    - [x] : 개인 휴가인 경우에는 연차 휴가의 잔여일수를 가지고 와서 비교해야 한다
    - [x] : 안식 휴가인 경우 안식 휴가의 잔여일수를 가지고 와서 비교해야 한다
      - [x] : 개인이 신청하는 휴가 <= 잔여 휴가 - 휴가 신청 허용
      - [x] : 개인이 신청하는 휴가 > 잔여 휴가 - 휴가 반려

- [ ] : **추가 예외 처리** 신청시 형식 문제인지 혹은 선후 관계 문제인지 알려주기
- [ ] : **추가 예외 처리** 동일한 날 휴가 신청 시 중복 불가하게 하기
- [ ] : **추가 예외 처리** 중간에 응답 속도가 살짝 느린 경향이 있는데 이를 어떻게 해결할 지 생각해보기

#### 휴가 / 연차 시스템 프로세스 - 취소 시스템 
- [x] 기존에 신청한 휴가 리스트업 완료
  - [x] 각각의 휴가에 번호를 붙여 출력하기
- [x] 번호를 입력받기
  - [x] 입력받은 번호가 수인지 확인
  - [x] 입력받은 번호가 1-전체 신청한 휴가 수의 범위를 만족하는지 확인
- [x] 스프레트 시트 관련된 API 수정 및 추가하기 
  - [x] 스프레드시트 관련 함수 인자에 sheet_number 반영
  - [x] 함수(sheet_id, sheet_number, new_row_data) 형식으로 변경 + sheet_number까지 변경 가능 in googleVacaptionApi
  - [x] 번호에 해당하는 레코드 스프레드 시트 상에서 제거
  - [ ] 이메일 관련 대문자 케이스도 고려해보기 - 정상 입력은 되는데 split() 관련해서 에러 발생함
- [x] 휴가 삭제 진행한 이후 조회, 추가, 삭제 기능 구현
  - [x] 조회 기능 구현
    - [x] 리스트로 출력 (형식 1. ....)
    - [ ] 빈 리스트의 경우 따로 say() 만들기
  - [x] 추가 기능 구현
    - [x] user_states 수정
  - [x] 삭제 기능 구현
    - [x] user_states 수정
- [ ] 안전하게 종료되는지 확인하는 과정 만들기 

#### 휴가 / 연차 시스템 프로세스 - 추가 구현 내용
- [x] 남은 휴가 일 수 보여주기
  - [x] ["남은 휴가 알려줘", "남은 휴가"]
  - [개인휴가 잔여일수, 안식휴가 잔여일수] 반환
- [x] 금일 휴가자 정보 보여주기 - "오늘 휴가자 알려줘", "금일 휴가자 알려줘"
  - [x] 추가 입력 없는 일회성 - user_states 반영할 필요가 없음
  - [x] 휴가신청 내역 가지고 오는 함수 만들기
    - [x] 시작 날짜 금일인 데이터만 가지고 오기
- [x] 매일 오전 8시 당일 휴가자 정보를 알려줘야 한다
  - [x] 별도 스레드 실행으로 2개의 프로그램이 동시에 진행되는 상황
  - [x] 8시 휴가자 알림 프로그램 그리고 슬랙봇 프로그램이 진행된다 

#### 추후 리팩토링할 사항들
- [ ] slack_bot.py 너무 크다 - 서비스 혹은 기능별로 별도로 구성해서 import 하는 방안 생각하기


#### 스프레드시트 관련 수정 사항

총 3개의 시트로 구성되어 있으며 휴가신청내역, 계산용, 통계 시트가 존재함
- 계산용은 이미 수식이 구성되어 있어 드래그 형태로 진행하면 문제가 없음
- 통계시트에도 휴가 종류에는 수식이 반영되어 있어 아무런 문제가 없음
- 연차 휴가 그리고 안식 휴가 상에서 사용일수가 수식이 반영이 되어 있지 않은게 문제
  - 연차 휴가, 예시를 보니 개인휴가만 반영되어 있어 개인휴가 칸의 값을 그대로 반영하는 걸로 스프레드시트 함수(SUM) 반영
  - 안식 휴가, 예시를 보니 안식휴가만 반영되어 있어 안식휴가 칸의 값을 그대로 반영하는 걸로 스프레드시트 함수(SUM) 반영
  
--- 

### 휴가 / 연차 신청 관련 추가 구현 사항

**어떤 파일에서 어떤 함수명 혹은 변수명을 적용할지 고민**

- [x] 휴가 신청의 연도를 확인해서 서로 다른 연도인 경우에는 <u>Basic template</u>을 복사해서 파일을 형성하고 데이터를 추가한다
  - [x] 현재 연도와 동일한 연도의 휴가를 신청하면 기존의 파일을 활용한다
  - [x] 현재 연도와 비교해서 다른 연도의 휴가를 신청하는 상황 (ex. 현재 2024년인데 2025년 1월 15일자 휴가를 신청하려는 상황)
    - [x] 입력한 휴가와 현재 연도를 비교하는 함수 구현
    - [x] 현재 연도와 다른 연도의 휴가를 신청한다면
      - [x] 신규 신청한 데이터의 연도를 파악하고 해당 연도의 휴가 내역을 저장하는 파일이 먼저 존재하는지 확인
      - [x] 해당 연도의 파일이 존재한다면 해당 파일에 데이터를 추가한다
        - [x] 해당 연도의 파일명 - 신규 신청한 데이터의 연도가 해당 연도의 파일명 내부에 존재하는지로 판단한다
          - [x] 파일명 형식을 내가 변수로 만들어서 일치하는 파일이 있는지를 확인한다
          - [x] 파일명 형식 만들기 in formatter.py에서 설정하기
      - [x] 존재하지 않으면 새로운 파일을 만든다. 이때 Basic template 파일을 활용한다
        - [x] 새로운 파일은 Basic template 파일을 복사해야 한다
        - [x] 새로운 파일은 신청한 연도를 반영한 새로운 이름으로 명명해야 한다
  - [x] **유의** 파일 형성이 마무리되었다면 1번 시트에 데이터가 존재하는지 확인한다
    - [x] 1번 시트에 데이터가 존재하지 않는다면 1번 시트의 5번째 행부터 신규 데이터를 추가한다
    - [x] 1번 시트에 데이터가 존재한다면 기존 데이터의 다음 행에 신규 데이터를 추가한다
     
- [x] 정상적으로 데이터가 추가되었다면 추가 완료라는 메세지를 전송한다


### 추가 수정 사항
- [ ] 현재 어떤 프로그램을 진행하고 있는지를 알려줄 수 있는 기능이 필요할 듯 (주관적인 의견)
  - [x] 무심결에 "종료"를 입력하는 경우도 존재한다
  - [x] 프로그램 진행 중 종료를 누르면 진행중인 프로세스가 종료되는지 확인

- [x] 휴가 신청 시스템 관련 chatGPT 한테 검색 받아서 배열에 넣어두기
  - [x] 오타 포함
  - [x] 최대 100개 이내로 진행

---

### 유지 보수 관련

- 오류코드 발생 시 특정 채널에 모아두기
- 문서화하기
- 배포 관련 오류 발생할 때 해결방법 찾기

---

### 로제봇 구현 관련

- [x] "로제봇 도와줘" 입력하게 되면 통합 시스템을 진행
  - [x] mention에서 로제봇 도와줘 관련 처리를 받아주고 
    - [x] 실행한다는 메세지, 기능 안내 메세지를 출력
  - [x] 응답을 받은 로제봇은 "아래 업무 중 무엇을 도와드릴까요"
    - [x] 1 - 휴가 신청 / 2 - 인사총무 업무 신청 / 3 - 문서 작성 / 4 - 회수 상황판 / 5 - 검색 / 6 - 1on1
    - [x] 1,2,3 은 구현한 기능 실행 (3-1까지 기능 실행, 3-2 그리고 3-3은 "공사중" 출력)
    - [x] 4, 5, 6를 입력한 경우 "공사중" 출력 
    - [x] 공백이 포함, 수 포함된 문자열인 경우 

---

### 1on1 기능

Google Drive 참고하기
- [ ] '1on1 멤버 생성' 파일에서 데이터를 가지고 온다(len(values) - 1)
  - [ ] 1번째 행은 Attribute가 반영된 상태이기 때문에 -1 한다.
  - [ ] len(values) - 1개의 데이터안에는 1명과 관련된 정보가 반영된 상황이다
  - [ ] 1명의 이름을 요소로 잡고 리스트로 구성하기


### 추가 피드백 구현 관련


+ 금일 휴가자 알림 all-임직원-인턴 채널 말고 - 개인 DM으로 

없으면 ":palm_tree:연차 사용이 없는 날입니다. 다들 좋은 하루 되셔요!" 이렇게 출력되고 있으면 ":palm_tree:금일 휴가자 명단입니다."라고 하고 쭈루룩 밑에 리스트가 나오면 좋을 것 같습니다

+ 채널 언급하고 DM으로 알람 오는거 해결하기 (DM 내에서만 소통하는게 1순위 - 2순위는 채널에 언급시 DM을 확인해달라는 메세지 전송하기)

1. 정기예금알람시스템 만들기
2. 채널에서 로제봇 호출 이슈 해결 ( 오늘 해결 할 수 있음 좋음 )
3. 전체 프로젝트 문서 만들기
4. 이름 "로제봇" 으로 바꿔서 2차 배포

1. 채널에 언급해서 대화 시작 못하게
2. 그게 아니면 채널에 언급해도 DM으로 안내하는 멘트 띄우는걸로

채널에서 로제봇 호출시 에러 로그 수정하기

1. 보건 휴가 -> 이름을 병결로 수정하고
2. 시간 설정 -> 하루 전체로 잡아두고 - 기존 회의 및 신규회의 형성되지 못하도록 설정하기

---

### 매번 체크해야 하는 내용 정리 + 정리 
- [ ] 금일 휴가 인원 잘 출력하는지 확인하기 
  - [x] 0806 checked
- [ ] 이자 알림 출력 양식 확인하기 - 당분간 계속 확인하기
- [ ] 등록 인원 캘린더 상에 아이디가 올바른지 확인하기
  - [x] rose054? - rose (숫자 전까지만 참조하도록 수정함)
  - [ ] 자신의 아이디로 등록된 구글 캘린더가 없는 경우 - 예외 처리해서 생성하는 멘트 출력해야 함 
- [x] 1on1 8주차 직접 돌려보고 이상한 아이디가 존재하는지 확인하기
  - [ ] **주의 사항** 권한 2이하 + bot, admin, notion excluded
  - [ ] **주의 사항** datetime 객체로 변환한 다음에 비교해야 함 (날짜로만, 시간 포함되었는지 꼭 확인하기)

### OCR
1. 현재 날짜를 보고 -> 연도_분기 파악해서 거기에 맞는 폴더 탐색 
2. 테스트 환경 만들어주고 (Completed)
3. 실행시키고 - 주주명부, 등기부등본 - 텍스트 추출(1) / 주주명부, 등기부등본 - 검토 및 DB 반영 (2) / 재무제표 - 텍스트 추출(3) / 재무제표 - 검토 및 DB 반영(4)
4. spreadsheet 검토가 끝났다. 이제 이걸 DB로 어떻게 반영시킬지 고민하는 중. 
5. 주주명부 폴더 아이디 / 등기부등본 폴더 아이디 / 주주명부, 등기부등본 공통 기업명 (1번 기능에서 제공해야 함)

내가 받아야 하는 기능은 - spreadsheet id (output) - 등기부등본 그리고 주주명부 + 완료된 기업명 + 미완료된 기업명

-> output으로 받는 스프레드 시트 id 정보를 계속 사용할 수 있어야 함.
-> 스프레드 시트 아이디로 접속해서 추출한 정보를 확인 - 기업명 부분을 확인하고 - DB 올리기 전에 - 검토용 스프레드 시트에 A B C… 기업이 존재한다를 알려줄 수 있어야 함.
-> DB에 올린 다음에는 - 업로드 완료된 스프레드 시트는 무조건 삭제. 

- [ ] 주주명부 파일명에 회사 이름이 반영되어야 함. 현재 스크린샷만 보유하고 있음. 로직 확인이 불가능함
- [ ] 출력시 유저 인터페이스 어떻게 
- [ ] 올바른 이름 중 공통된 기업명으로 할 것인지도 생각해보기